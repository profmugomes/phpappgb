' Gambas class file

'phpapp
'Author Murilo Gomes <contatoprofmugomes@gmail.com>
'Copyright (c) 2023 Murilo Gomes
'License GPL-2.0
'Version 1.0.0, 2023-02-20

Public sProcess As Process
Public sCount As Integer = 1
Public sURL As String = ""

Public Sub Form_Resize()
  wb.Width = Me.Width
  wb.Height = Me.Height
End

Public Sub lh_Start()
  sProcess = Shell "php -S localhost:0 -t " & Application.Path & "/www/" For Input As "Process"
End

Public Sub Process_Read()
  Dim sLine As String
  Dim sHost As String
  
  Read #Last, sLine, -256
  
  If Not sLine = "" Then
    If sCount = 1 Then
      Shell "echo '" & sLine & "' | grep -oh 'localhost:[0-9]*'" Wait To sHost
      
      wb.Url = "http://" & sHost 
      
      sCount = 2
    Endif
  Endif 
End

Public Sub Form_Open()
  If sURL.Len > 0 Then
    wb.Url = sURL
  Endif
End

Public Sub Form_Close()
  If sURL = "" Then 
    sProcess.Kill()
  Endif 
End

Public Sub wb_NewView()
  Dim FBrowser As New FMain
  FBrowser.sURL = wb.Link
  FBrowser.Show()
End
